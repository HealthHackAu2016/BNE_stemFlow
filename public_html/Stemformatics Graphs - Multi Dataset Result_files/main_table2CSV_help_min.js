autocompleteTimeout=5000;function check_browser_version(b,a){if(parseInt(b)<a&&(document.URL.indexOf("browser_compatibility")==-1)){window.location=BASE_PATH+"contents/browser_compatibility"}}function check_browser(){navigator.sayswho=(function(){var b=navigator.userAgent,a,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(c[1])){a=/\brv[ :]+(\d+)/g.exec(b)||[];return"IE "+(a[1]||"")}if(c[1]==="Chrome"){a=b.match(/\b(OPR|Edge)\/(\d+)/);if(a!=null){return a.slice(1).join(" ").replace("OPR","Opera")}}c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"];if((a=b.match(/version\/(\d+)/i))!=null){c.splice(1,1,a[1])}full_browser_name=c.join(" ");browser_name=c[0];browser_version=c[1];return[browser_name,browser_version]})();result=navigator.sayswho;browser_name=result[0];browser_version=result[1];if(browser_name=="Chrome"){minimum_version=39;check_browser_version(browser_version,minimum_version)}if(browser_name=="Firefox"){minimum_version=34;check_browser_version(browser_version,minimum_version)}if(browser_name=="Safari"){minimum_version=7;check_browser_version(browser_version,minimum_version)}if(browser_name=="MSIE"){minimum_version=11;check_browser_version(browser_version,minimum_version)}}function project_grandiose_click_header(){$("div.pg_header").click(function(){window.location=BASE_PATH+"project_grandiose"})}function filterGeneSymbol(a,b){var f=a.split(" ");var d=f[0];for(var c=1;c<f.length;++c){var e=f[c];if(e.search(/LOC[0-9]{1,10}?/)){d=d+b+e}}return d}function filterGeneDescription(a,g){delimiter="&lt;br /&gt;";var f=a.split(" ");var b=g.split(delimiter);var c=b[0];for(var d=1;d<f.length;++d){var e=f[d];if(e.search(/LOC[0-9]{1,10}?/)){c=c+"<br />"+b[d]}}return c}function CanvasSaver(a){this.url=a;this.savePNG=function(g,f){if(!g||!a){return}f=f||"picture";var e=g.toDataURL("image/png");e=e.substr(e.indexOf(",")+1).toString();var b=document.createElement("input");b.setAttribute("name","imgdata");b.setAttribute("value",e);b.setAttribute("type","hidden");var d=document.createElement("input");d.setAttribute("name","name");d.setAttribute("value",f+".png");var c=document.createElement("form");c.method="post";c.action=a;c.appendChild(b);c.appendChild(d);document.body.appendChild(c);c.submit();document.body.removeChild(c)}}function export_image_button_click(){var a=new CanvasSaver("/main/save_image");$(".exportImageButton").unbind("click");$(".exportImageButton").click(function(c){graph_id=$(this).attr("data-id");var b=$(graph_id+" canvas.flot-base").get(0);fname="save_img";a.savePNG(b,fname);return false});$(".exportLegendButton").unbind("click");$(".exportLegendButton").click(function(c){graph_id=$(this).attr("data-id");var b=$(graph_id+" canvas").get(0);fname="save_img";a.savePNG(b,fname);return false})}function help_icon_in_page_help(){$("div.help_icon").hover(function(){$("div.help_icon ul").addClass("main_help_menu").removeClass("hidden")});$helpButton=$("div.help_icon a.page_guide");$("div.help_icon a").click(function(){$("div.help_icon ul.main_help_menu").removeClass("main_help_menu").addClass("hidden")});$helpButton.live("click.PageGuide",function(a){if(helpsystem.pageHelp.isOn){helpsystem.pageHelp.turnOff();$helpButton.removeClass("active")}else{helpsystem.pageHelp.turnOn();$helpButton.addClass("active")}return false})}function dropdown_buttons(){$("ul.buttonMenus a.button.dropdown").live("click",function(c){c.preventDefault();var b=$(this);var a=b.parent().children("ul");b.addClass("down");a.toggle();$("ul.submenu").bind("mouseup",function(d){$("ul.submenu").hide();b.removeClass("down");$("ul.submenu").unbind("mouseup")})});$("ul.buttonMenus ul.submenu").on("mouseleave",function(){$(this).hide()})}function contextHelpClick(){$helpButton=$("a.helpPopup,a.helpbtnPopup,#helpMenu");$helpButton.unbind("click");$helpButton.click(function(a){if(helpsystem.pageHelp.isOn){helpsystem.pageHelp.turnOff();$helpButton.removeClass("active")}else{helpsystem.pageHelp.turnOn();$helpButton.addClass("active")}return false})}function parseUri(e){var d=parseUri.options,a=d.parser[d.strictMode?"strict":"loose"].exec(e),c={},b=14;while(b--){c[d.key[b]]=a[b]||""}c[d.q.name]={};c[d.key[12]].replace(d.q.parser,function(g,f,h){if(f){c[d.q.name][f]=h}});return c}parseUri.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};function URL(a){a=a.replace("#","");temp_result=a.split("?");this.base_url=temp_result[0];get_data=temp_result[1];get_data_array=get_data.split("&");get_dict={};for(var b in get_data_array){temp_result=get_data_array[b].split("=");get_dict[temp_result[0]]=temp_result[1]}this.get_data=get_dict}URL.prototype.get_url=function(){temp_array=[];for(key in this.get_data){value=this.get_data[key];if(value!=""){temp_string=key+"="+value;temp_array.push(temp_string)}}var a=temp_array.join("&");url=this.base_url+"?"+a;return url};CURRENT_URL=parseUri(window.location);(function(a){a.belowthefold=function(c,d){var b=a(window).height()+a(window).scrollTop();return b<=a(c).offset().top-d.threshold};a.abovethetop=function(b,c){var d=a(window).scrollTop();return d>=a(b).offset().top+a(b).height()-c.threshold};a.rightofscreen=function(c,d){var b=a(window).width()+a(window).scrollLeft();return b<=a(c).offset().left-d.threshold};a.leftofscreen=function(b,c){var d=a(window).scrollLeft();return d>=a(b).offset().left+a(b).width()-c.threshold};a.inviewport=function(b,c){return !a.rightofscreen(b,c)&&!a.leftofscreen(b,c)&&!a.belowthefold(b,c)&&!a.abovethetop(b,c)};a.extend(a.expr[":"],{"below-the-fold":function(c,d,b){return a.belowthefold(c,{threshold:0})},"above-the-top":function(c,d,b){return a.abovethetop(c,{threshold:0})},"left-of-screen":function(c,d,b){return a.leftofscreen(c,{threshold:0})},"right-of-screen":function(c,d,b){return a.rightofscreen(c,{threshold:0})},"in-viewport":function(c,d,b){return a.inviewport(c,{threshold:0})}})})(jQuery);$(function(){$("div.showText").mouseover(function(){$(this).children().addClass("hoverState").children().addClass("hoverState")}).mouseout(function(){$(this).children().removeClass("hoverState").children().removeClass("hoverState")});$("a[target=_blank]").click(function(){var e=confirm("The link you clicked is opening up another window/tab. Is that OK?");if(!e){return false}});project_grandiose_click_header();$("a.in_page_tutorial_link").live("click",function(){tutorial_name=$(this).attr("data-tutorial");helpsystem.tutorial.start(tutorial_name);return false});if($("#recaptcha_whatsthis_btn")){$("#recaptcha_whatsthis_btn").unbind("click")}$("#ucsc_select").change(function(){var e=$(this).val();if(e!=0){newwindow=window.open(e,"_blank","resizable=yes, scrollbars=yes, width=1024, height=900, top=10, left=10")}});$("div.search_box a.searchButton").hover(function(){$(this).children("img").attr("src",BASE_PATH+"images/show_genes_rollover.png")},function(){$(this).children("img").attr("src",BASE_PATH+"images/show_genes.png")});$("div.wb_help_bar").live("click",function(){$(this).children().html('Hide help information <img class="help" src="'+BASE_PATH+'images/workbench/minus.png"">');$(this).removeClass("wb_help_bar").addClass("wb_help_bar_showing");$(this).next(".wb_help").addClass("wb_help_showing").removeClass("wb_help")});$("div.wb_help_bar_showing").live("click",function(){$(this).children().html('Show help information <img class="help" src="'+BASE_PATH+'images/workbench/plus.png"">');$(this).removeClass("wb_help_bar_showing").addClass("wb_help_bar");$(this).next(".wb_help_showing").addClass("wb_help").removeClass("wb_help_showing")});$("div.wb_help_bar div.wb_help_bar_inner_div").html('Show help information <img class="help" src="'+BASE_PATH+'images/workbench/plus.png"">');var a=$("#show_help_flag").html();if(a=="NO"){$("div.flag").remove()}else{var b=$("#help_flag_message").html();if(b!=null){$("div.flag div.flag_inner_div").html(b)}var d=$("#help_flag_top_position").html();if(d!=null){$("div.flag").css("top",d)}var c=$("#help_flag_left_position").html();if(c!=null){$("div.flag").css("left",c)}}$("a.wb_open_help").click(function(){$("div.wb_help_bar_inner_div").click()});simple_tooltip("div.large_icon","tooltip");simple_tooltip("a.logo","tooltip");help_icon_in_page_help();dropdown_buttons()});function simple_tooltip(b,a){$(b).each(function(c){$(this).mouseover(function(){my_tooltip=create_tooltip($(this));my_tooltip.css({display:"none"}).fadeIn(40)}).mousemove(function(d){my_tooltip.css({left:d.pageX+15,top:d.pageY-15})}).mouseout(function(){my_tooltip.fadeOut(40);my_tooltip.remove()})})}function create_tooltip(a){$("#generic_tooltip").remove();$("body").append("<div id='generic_tooltip'><p>"+a.attr("data_hover_text")+"</p></div>");var b=$("#generic_tooltip");return b}function innate_db_link_clicks(){$("a.innate_db").click(function(){innate_db_type=$(this).attr("data_type");var a=confirm("This will take you to the InnateDB website. Any analyses will need to be saved at this website. Is that OK?");if(!a){return false}$('form.innate_db_form input[name="listType"]').val(innate_db_type);$("form.innate_db_form").submit()})}function setup_feature_search_autocomplete(b){var a=$(b.id);if(a.length>0){a.autocomplete({source:b.data_url,minLength:4,timeout:autocompleteTimeout,appendTo:b.append_to,select:function(d,e){var c=e.item.feature_id;window.location=b.target_url+encodeURIComponent(c)}});a.data("ui-autocomplete")._renderItem=function(c,d){html=$("<li></li>").append("<a> <div class='symbol'>"+d.symbol+"</div><div class='species'>"+d.species+"</div><div class='aliases'>"+d.aliases+"</div><div class='description'>"+d.description+"</div><div class='clear'></div></a>").appendTo(c);return html}}}var ajax_search;ajax_search=function(b){var f,d,e,c,g,a;this.get_base_url=function(){return f};this.set_data=function(h){d=h;return true};this.get_data=function(){return d};this.get_ajax_url=function(){return a};this.get_html=function(){return c};this.build_html_from_data_for_datasets=function(i,h){d=jQuery.parseJSON(i);datasets=d.datasets;filter=d.filter;c='<div class="basic_help">Select a dataset</div><div class="multi_select"><div class="export"><ul class="buttonMenus"><li id="exportMenu"><a class="button dropdown"><span><span class="icon go"></span>Export</span><span class="arrow down"></span></a><ul class="submenu"><li><a href="'+f+"?filter="+filter+'&export=true" id="exportTableCSVButton">Export Data</a></li></ul></li></ul></div><table id="'+g+'" class="fixed"><thead><tr><th>Datasets</th></tr></thead><tbody>';count=0;for(ds_id in datasets){count++;row=datasets[ds_id];name=row.name;cells_samples_assayed=row.cells_samples_assayed;organism=row.organism;title=row.title;c=c+'<tr><td><div class="multi_select_row"><a id="choose_dataset_'+ds_id+'" href="'+f+"?ds_id="+ds_id+"&filter="+filter+'"><div class="inner"><div class="title">'+title+'</div><div class="handle">'+name+'</div><div class="cells">'+cells_samples_assayed+'</div></div><div class="organism">'+organism+'</div><div class="small_arrow"></div><div class="clear"></div></a></div></td></tr>'}c=c+"</tbody></table></div>";return c};this.build_html_from_data_for_genes=function(i,h){d=jQuery.parseJSON(i);genes=d.genes;filter=d.filter;c='<div class="basic_help">Select a gene</div><div class="multi_select"><div class="export"><ul class="buttonMenus"><li id="exportMenu"><a class="button dropdown"><span><span class="icon go"></span>Export</span><span class="arrow down"></span></a><ul class="submenu"><li><a href="'+f+"?filter="+filter+'&export=true" id="exportTableCSVButton">Export Data</a></li></ul></li></ul></div><table id="'+g+'" class="fixed"><thead><tr><th>Genes</th></tr></thead><tbody>';count=0;for(number in genes){count++;row=genes[number];aliases=row.aliases;species=row.species;ensembl_id=row.ensembl_id;db_id=row.db_id;description=row.description;symbol=row.symbol;c=c+'<tr><td><div class="multi_select_row"><a id="choose_gene_'+ensembl_id+'" href="'+f+"?ensembl_id="+ensembl_id+"&filter="+filter+'"><div class="inner"><div class="title"><span class="ensembl_id">'+ensembl_id+"</span>"+symbol+'</div><div class="handle">'+aliases+'</div><div class="cells">'+description+'</div></div><div class="organism">'+species+'</div><div class="small_arrow"></div><div class="clear"></div></a></div></td></tr>'}c=c+"</tbody></table></div>";return c};this.show_html=function(h,i){$("#wb_modal_title").html("Showing all "+count+" "+i+' for "'+filter+'"');$("#wb_modal_content").html(h);$("#wb_modal_content div.multi_select").show();$("#modal_div").modal({minHeight:400,minWidth:800,onShow:function(j){$("#"+g).dataTable({bPaginate:false,bLengthChange:false,bFilter:true,bSort:false,bInfo:false,bAutoWidth:false})}})};this.get_data_from_ajax=function(i){var l=this.build_html_from_data_for_datasets;var k=this.build_html_from_data_for_genes;var h=this.show_html;var m=this.data_type;url=a+"?";filters=new Array();for(key in i){value=i[key];url_part=key+"="+value;filters.push(url_part)}url=url+filters.join("&");var j=$.ajax({type:"POST",data:d,url:url});j.done(function(n){if(m=="datasets"){c=l(n,filter);h(c,m)}if(m=="genes"){k(n,filter);h(c,m)}});j.fail(function(n,o){alert("Request failed: "+o)})};this.init=function(h){c=h.html;a=h.ajax_url;d=h.data;e=h.data_type;f=h.base_url};this.init(b);return this};function set_view_datasets(b,a){search_button_id="#view_datasets";input_text_field_id="#dataset_search";data_type="datasets";set_search_and_choose(b,a,search_button_id,input_text_field_id,data_type)}function set_search_and_choose(g,c,a,d,f){if(a.length){ajax_url=BASE_PATH+f+"/search_and_choose_"+f+"_ajax";var b={base_url:g,data_type:f,ajax_url:ajax_url};var e=ajax_search(b);ajax_url=e.get_ajax_url();input_text_field=$(d);search_button=$(a);input_text_field.keypress(function(h){if(h.which==13){h.preventDefault();filter=input_text_field.val();c.filter=filter;e.get_data_from_ajax(c)}});search_button.click(function(h){h.preventDefault();filter=input_text_field.val();c.filter=filter;e.get_data_from_ajax(c)})}}data_table=function(c){var h,a,e,i,b,f,d,g,j;this.setup_click_target_id=function(){target=$(f);var k=this.show_data_table;target.click(function(){k()})};this.show_data_table=function(){html='<div class="'+j+'"><table id="'+id_for_table+'" class="fixed"><thead><tr>';for(key in g){value=d[key];html=html+"<th>"+value.replace(/_/g," ")+"</th>"}html=html+"</tr></thead><tbody>";count=0;for(row_num in e){count++;row=e[row_num];html=html+"<tr>";for(key in g){column_name=g[key];value=row[column_name];if(is_float(value)){value=round_to_two_decimal_places(value)}html=html+"<td>"+value+"</td>"}html=html+"</tr>"}html=html+"</tbody></table></div>";$("#wb_modal_title").html(h);$("#wb_modal_content").html(html);$("#modal_div").modal({minHeight:i,minWidth:b,onShow:function(k){$("#"+id_for_table).dataTable({bPaginate:false,bLengthChange:false,bFilter:true,bSort:true,bInfo:false,aaSorting:[[1,"asc"]],bAutoWidth:false})}})};this.init=function(k){h=k.title;f=k.click_target_id;b=k.min_width;i=k.min_height;a=k.ds_id;d=k.column_names;e=k.data;g=k.columns_to_show_in_order;j=k.div_class;id_for_table=a+j;table_id="new_choose_dataset";this.setup_click_target_id()};this.init(c);return this};function round_to_two_decimal_places(a){new_num=Math.round(a*100)/100;return new_num}function is_float(a){var b=/^-?[.0-9]+$/;return b.test(a)}function check_user_logged_in_for_sharing(){var b=$("#full_name").html();var a=$("#uid").html();if(a=="0"||b=="Guest Account"){$("#wb_modal_title").html("Share this graph");$("#wb_modal_content").html("You must be logged in to share in "+SITE_NAME+".");$("#modal_div").modal({minHeight:80});return false}return true}jQuery.fn.table2CSV=function(l){var l=jQuery.extend({separator:",",header:[],delivery:"popup"},l);var j=[];var a=[];var d=this;var e=l.header.length;var k=[];if(e>0){for(var h=0;h<e;h++){k[k.length]=c(l.header[h])}}else{$(d).find("th").each(function(){if($(this).css("display")!="none"){k[k.length]=c($(this).html())}})}g(k);$(d).find("tr").each(function(){var i=[];$(this).find("td").each(function(){check_display=$(this).css("display");if(check_display!="none"){i[i.length]=c($(this).html())}});g(i)});if(l.delivery=="popup"){var f=j.join("\n");return b(f)}else{var f=j.join("\n");return f}function g(i){var n=i.join("");if(i.length>0&&n!=""){var m=i.join(l.separator);j[j.length]=m}}function c(m){var n=new RegExp(/["]/g);var i=m.replace(n,"â€œ");var n=new RegExp(/\<[^\<]+\>/g);var i=i.replace(n,"");if(i==""){return""}return'"'+i+'"'}function b(i){$("body").append('<form id="exportform" action="'+BASE_PATH+'main/export" method="post" target="_blank"><input type="hidden" id="exportdata" name="exportdata" /></form>');$("#exportdata").val(i);$("#exportform").submit().remove();return true}};