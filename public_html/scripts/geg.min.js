var bandwidth_line_width=15;var roundTo=5;var y_axis_adjustment=7;var splitAttribute="|";var max_y_axis=null;var minXaxis=-0.5;var floorValue=-999999999;var minStartingValue=100000000000;var maxStartingValue=-100000000000;var angle_horizontal=0;var angle_diagonal=-Math.PI/6;var angle_vertical=-Math.PI/2;var angle_logo=Math.PI/2;function draw_logo(f){var c=f.plot.getCanvas();var b=c.getContext("2d");var e=new Image();var d=355;if(f.header=="grandiose"){var a=new Image();a.onload=function(){b.save();var g=Math.PI/2;b.rotate(g);b.fillStyle="#000000";b.fillRect(430,-c.width+min_border_margin-60,272,54);b.drawImage(a,430,-c.width+min_border_margin-60);b.restore()};a.src="/images/grandiose/Project_Grandiose.gif";d=200}e.onload=function(){b.save();var g=Math.PI/2;b.rotate(g);this_width=$("canvas.flot-overlay").css("width").replace("px","");set_x_axis_for_logo=-this_width+min_border_margin-40;b.drawImage(e,d,set_x_axis_for_logo);b.restore()};e.src="/img/logo.gif"}function draw_legend_on_canvas(k){kinetic_width=1800;kinetic_height=800;var d="kinetic_legend";var e=new Kinetic.Layer();var f=new Kinetic.Text({x:20,y:20,text:"Legend",fontSize:36,align:"center",fontFamily:"sans-serif",fill:"black"});e.add(f);var g=new Object();g.offset_y=35;g.start_y=70;g.this_y=g.start_y;g.this_x=25;g.height_of_square=11;g.width_of_square=15;g.txt_y_offset=1;var a=k.sample_type_display_order;var i=k.plot;var n=k.plot_data;number_of_legends=0;if(k.graph_type=="scatter"){for(var b in k.plot_data){colour=k.probe_color_dict[b]["color"];raw_probe=b;display_probe_id=k.probe_color_dict[b]["display_probe_id"]+" "+raw_probe;url="";txt_colour="black";var c=k.probe_information[b];if(c>1){txt_colour="red";display_probe_id=display_probe_id+"*";chip_type=k.chip_type;db_id=k.db_id;url="/probes/multi_map_summary?probe_id="+encodeURIComponent(raw_probe)+"&chip_type="+chip_type+"&db_id="+db_id}mouse_over=b;draw_individual_legends(e,g,display_probe_id,colour,txt_colour,url,k,mouse_over);number_of_legends++}}else{if(k.graph_type=="line"){a=[]}var l={};for(var m in n){if(m.indexOf("|")!=-1){original_sample_type=m;temp_sample_type=m.split("|");m=temp_sample_type[1];colour=n[original_sample_type].color}else{colour=n[m].color}if(k.graph_type=="line"){j=jQuery.inArray(m,a);if(j==-1){a.push(m);a.sort()}}l[m]=colour}for(var j in a){m=a[j];colour=l[m];url="";txt_colour="black";mouse_over="";e=draw_individual_legends(e,g,m,colour,txt_colour,url,k,mouse_over);number_of_legends++}}number_of_legend_columns=Math.ceil(number_of_legends/20);width=300;if(number_of_legend_columns>1){width=30+(number_of_legend_columns)*200;height=800}else{height=(number_of_legends*35)+100}$("#kinetic_legend").css("width",width+"px").css("height",height+"px");var h=new Kinetic.Stage({container:d,width:width,height:height});h.add(e)}function draw_individual_legends(f,h,b,a,d,c,j,g){if(h.this_y>740){h.this_y=h.start_y;h.this_x=h.this_x+200}var i=new Kinetic.Rect({x:h.this_x-2,y:h.this_y-2,width:h.width_of_square+4,height:h.width_of_square+4,fill:"white",stroke:"black",strokeWidth:1});f.add(i);var i=new Kinetic.Rect({x:h.this_x,y:h.this_y,width:h.width_of_square,height:h.width_of_square,fill:a,stroke:"black",strokeWidth:1});f.add(i);var e=new Kinetic.Text({x:h.this_x+20,y:h.this_y+h.txt_y_offset,text:b,fontSize:12,align:"left",width:180,fontFamily:"sans-serif",fill:d});if(j.graph_type=="scatter"&&j.ref_type!="miRNA"){e.setName(g);e.on("mouseover",function(k){display_name_full=k.targetNode.attrs.text;$("#generic_tooltip").hide().html(display_name_full).css("top",k.pageY).css("left",k.pageX+30).show()});e.on("mouseout",function(k){$("#generic_tooltip").hide()})}if(c!=""){e.url=c;e.on("click",function(){window.location=this.url})}f.add(e);h.this_y=h.this_y+h.offset_y;return f}function draw_xaxis_labels(n){xaxis_labels=n.xaxis_labels;var e=n.plot.getPlotOffset();var l=n.plot.getAxes();if(n.click_to_select_probes==undefined){n.click_to_select_probes=false}kinetic_width=1170;if(n.expand_horizontally){kinetic_width=n.expand_horizontally_width}var f="xaxis_labels"+n.ds_id;var k=new Kinetic.Stage({container:f,width:kinetic_width,height:220});var j=new Kinetic.Layer();for(var g in xaxis_labels){var b=xaxis_labels[g]["level"];var o=xaxis_labels[g]["xaxis_position"];var c=xaxis_labels[g]["id"];var a=xaxis_labels[g]["name"];var d=n.probe_information[c];var m=xaxis_labels[g]["type"];txt=new Object();multi_map=false;txt.fill_style="black";raw_probe=c;if(d>1&&n.click_to_select_probes==false){txt.fill_style="red";a=a+"*";multi_map=true}txt.angle=angle_diagonal;txt.plot=n.plot;if(large){if(b==1){txt.abs_y=2155}if(b==2){txt.abs_y=2500}}else{if(b==1){txt.abs_y=735;kinetic_y=101}if(b==2){txt.abs_y=790;kinetic_y=195}}txt.x=o+0.2;txt.text_align="right";txt.font="12px sans-serif";var l=txt.plot.getAxes();if(m=="Probe"&&n.ref_type!="miRNA"){txt.text=a+" "+c}else{txt.text=a}length_of_name=txt.text.length;if(length_of_name>=20){half_length_of_name=length_of_name/2;name1=txt.text.slice(0,half_length_of_name);name2=txt.text.slice(half_length_of_name);txt.text=name1;draw_text_on_canvas(txt);txt.text=name2;txt.abs_y=txt.abs_y+15;draw_text_on_canvas(txt)}else{draw_text_on_canvas(txt)}kinetic_x=l.xaxis.p2c(txt.x)+e.left-178;var h=new Kinetic.Text({x:kinetic_x,y:kinetic_y,text:a,fontSize:13,align:"right",rotationDeg:330,fontFamily:"sans-serif",width:200,fullText:txt.text,fill:txt.fill_style});if(m=="Probe"&&n.ref_type!="miRNA"){h.setName(c);h.on("mouseover",function(i){display_name_full=i.targetNode.attrs.text+" "+i.targetNode.attrs.name;$("#generic_tooltip").hide().html(display_name_full).css("top",i.pageY).css("left",i.pageX+30).show()});h.on("mouseout",function(i){$("#generic_tooltip").hide()})}if(multi_map){h.raw_probe=raw_probe;h.chip_type=n.chip_type;h.db_id=n.db_id;h.on("click",function(){window.location="/probes/multi_map_summary?probe_id="+encodeURIComponent(this.raw_probe)+"&chip_type="+this.chip_type+"&db_id="+this.db_id})}if(n.click_to_select_probes){h.raw_probe=raw_probe;h.on("click",function(){var p=$("div.select_probes textarea");var i=p.val();if(i==""){p.val(this.raw_probe)}else{p.val(i+" "+this.raw_probe)}})}j.add(h)}k.add(j)}function set_markings_to_array(b){markings=[];for(var a in b.markings){markings[a]=b.markings[a]}return markings}function is_array(a){return typeof(a)=="object"&&(a instanceof Array)}function roundNumber(b,c){var a=Math.round(b*Math.pow(10,c))/Math.pow(10,c);return a}function drawGraph(a){graph_id=a.graph_id;a.plot=$.plot($(graph_id),a.flot_data,a.options);draw_xaxis_labels(a);draw_yaxis_labels(a);draw_title(a);draw_detection_threshold_and_median(a);draw_legend_on_canvas(a);draw_logo(a);return a}function draw_detection_threshold_and_median(e){var a=txt.plot.getCanvas().getContext("2d");var d=txt.plot.getPlotOffset();var c=txt.plot.getAxes();var b=20;detection_threshold=e.detection_threshold;if(detection_threshold!=undefined&&detection_threshold!=0&&detection_threshold!="NULL"){txt=new Object();txt.text="DT ("+detection_threshold+")";txt.angle=angle_horizontal;txt.plot=e.plot;txt.abs_y=c.yaxis.p2c(detection_threshold)+d.top+b;txt.x=e.min_x_axis;txt.width=200;txt.text_align="left";txt.fill_style="#000";draw_text_on_canvas(txt)}median_dataset_expression=e.median_dataset_expression;if(median_dataset_expression!=undefined&&median_dataset_expression!=0&&median_dataset_expression!="NULL"){txt=new Object();txt.text="Med ("+median_dataset_expression+")";txt.angle=angle_horizontal;txt.plot=e.plot;txt.abs_y=c.yaxis.p2c(median_dataset_expression)+d.top+b;txt.x=e.min_x_axis;txt.width=200;txt.text_align="left";txt.fill_style="#000";draw_text_on_canvas(txt)}}function wrapText(d,j,i){if(d.text==undefined){return false}j=d.maxWidth;i=d.lineHeight;var a=d.plot.getCanvas().getContext("2d");var k=d.text;var c=d.plot.getPlotOffset();var f=d.plot.getAxes();if(d.hasOwnProperty("x")){x=f.xaxis.p2c(d.x)+c.left}if(d.hasOwnProperty("y")){y=f.yaxis.p2c(d.y)+c.top+y_axis_adjustment}if(d.hasOwnProperty("abs_x")){x=d.abs_x}if(d.hasOwnProperty("abs_y")){y=d.abs_y}var h=k.split(" ");var m="";for(var b=0;b<h.length;b++){var e=m+h[b]+" ";var g=a.measureText(e);var l=g.width;if(l>j&&b>0){a.fillText(m,x,y);m=h[b]+" ";y+=i}else{m=e}}a.fillText(m,x,y)}function draw_title(f){var c=f.plot.getAxes();var a=c.yaxis.min;var d=c.yaxis.max;var b=c.xaxis.min;var e=c.xaxis.max;txt=new Object();txt.text=f.cells_samples_assayed;txt.angle=angle_horizontal;txt.plot=f.plot;range=d-a;txt.y=d+(range/10);if(label_dimensions.hasOwnProperty("xaxis_center_label_x")){txt.abs_x=label_dimensions.xaxis_center_label_x}else{txt.x=(e-b)/2}txt.font="16px sans-serif";txt.text_align="center";txt.fill_style="#000";txt.maxWidth=900;txt.lineHeight=16;wrapText(txt);txt.text=f.title_dataset;txt.y=txt.y+(range/15);wrapText(txt);txt.text=f.title+f.title_id+" "+f.title_grouped;txt.y=txt.y+(range/15);draw_text_on_canvas(txt)}function calc_decimal_places(a){temp=1/a;if(temp>0&&temp<=10){return 1}if(temp>10&&temp<=100){return 2}if(temp>100&&temp<=1000){return 3}}function draw_yaxis_labels(f){label_dimensions=f.label_dimensions;var b=f.plot.getAxes();var d=b.yaxis.max;original_min_y=parseInt(f.original_min_y_axis);if(original_min_y<0){var a=original_min_y}else{var a=0}decimal_places=calc_decimal_places(d);if(d>0&&d<1){multiplier=Math.pow(10,decimal_places);a=a*multiplier;d=d*multiplier}else{multiplier=1}for(var c=a;c<=d;c++){var e=c/multiplier;txt=new Object();txt.angle=angle_horizontal;txt.plot=f.plot;txt.font=" 12px sans-serif";txt.abs_x=label_dimensions.yaxis_ticks_abs_x;txt.y=e;txt.text=e;txt.width=200;txt.text_align="right";draw_text_on_canvas(txt)}txt=new Object();txt.text=f.y_axis_label;txt.angle=angle_vertical;txt.plot=f.plot;txt.abs_y=label_dimensions.yaxis_label_abs_y;txt.abs_x=label_dimensions.yaxis_label_abs_x;txt.width=200;txt.text_align="center";draw_text_on_canvas(txt)}function set_detection_threshold_and_median(d,c,b){detection_threshold=d.detection_threshold;min_x_axis=d.min_x_axis;max_x_axis=d.max_x_axis;if(detection_threshold!=undefined&&detection_threshold!=0){c[b]={data:[[min_x_axis,detection_threshold],[max_x_axis,detection_threshold]],color:"blue",label:false,lines:{show:true}};b++}var a=d.median_dataset_expression;if(a!=undefined&&a!=0){c[b]={data:[[min_x_axis,a],[max_x_axis,a]],color:"green",label:false,lines:{show:true}}}return c}Object.prototype.hasOwnProperty=function(a){return this[a]!==undefined};function draw_text_on_canvas(b){var d=b.plot.getCanvas().getContext("2d");var g=b.plot.getPlotOffset();var f=b.plot.getAxes();if(b.hasOwnProperty("x")){x=f.xaxis.p2c(b.x)+g.left}if(b.hasOwnProperty("y")){y=f.yaxis.p2c(b.y)+g.top+y_axis_adjustment}if(b.hasOwnProperty("abs_x")){x=b.abs_x}if(b.hasOwnProperty("abs_y")){y=b.abs_y}d.textBaseline="bottom";d.fillStyle=(b.fill_style!==undefined)?b.fill_style:"#000";d.lineStyle=(b.line_style!==undefined)?b.line_style:"#FFF";d.font=(b.font!==undefined)?b.font:"16px sans-serif";b.large=typeof large!=="undefined"?b.large:false;if(b.large){d.font="50px sans-serif"}d.textAlign=(b.text_align!==undefined)?b.text_align:"left";var e=d.measureText(b.text);d.save();var c=x;var a=y;d.translate(c,a);d.rotate(b.angle);d.translate(-c,-a);d.fillText(b.text,x,y);d.restore()};var small_width=1275;var large_width=4300;var small_height=900;var large_height=2500;var largeWidth=4000;var AUTOCOMPLETE_TIMEOUT=5000;var standardHeight=964;var standardIE7Height=984;var ie7ChangeInnerDiv=758;var ds_id=0;var db_id="";var this_graph_data={};function afterGraphDrawn(){db_id=this_graph_data.view_data.db_id;contextHelpClick();check_remove_loading();hide_tables();add_buttons_for_viewing_graph_tables();set_draggables();plot_hover();set_clicks()}function set_draggables(){$("div.movable_legend").draggable()}function set_autocomplete(){set_gene_search_and_autocomplete();set_probe_search_and_autocomplete();set_feature_search_and_autocomplete()}function set_gene_search_and_autocomplete(){if($("#geneSearchForm").is(":visible")){$("#geneSearch").autocomplete({source:BASE_PATH+"genes/get_autocomplete?db_id="+db_id,minLength:4,timeout:AUTOCOMPLETE_TIMEOUT,appendTo:".searchBox",select:function(a,b){var c=b.item.ensembl_id;change_gene(c)}}).data("ui-autocomplete")._renderItem=function(a,b){return $("<li></li>").append("<a> <div class='symbol'>"+b.symbol+"</div><div class='species'>"+b.species+"</div><div class='aliases'>"+b.aliases+"</div><div class='description'>"+b.description+"</div><div class='clear'></div></a>").appendTo(a)};$("#geneSearch").keypress(function(a){if(a.which==13){a.preventDefault();var b=$("#geneSearch").val();change_gene(b);return false}});$("#geneSearchForm").unbind();$("#geneSearchForm").submit(function(){$("#geneSearch").autocomplete("close");var a=$("#geneSearch").val();change_gene(a);return false})}}function set_probe_search_and_autocomplete(){$("#probeSearch").autocomplete({source:BASE_PATH+"datasets/autocomplete_probes_for_dataset?ds_id="+ds_id,minLength:2,timeout:AUTOCOMPLETE_TIMEOUT,appendTo:".searchBox",select:function(b,c){var a=c.item.value;chosen_probe_action(a)}});$("#viewProbes,#probeSearchSubmit").click(function(){var a=$("#probeSearch").val();chosen_probe_action(a);return false});$("#probeSearchForm").submit(function(b){b.preventDefault();var a=$("#probeSearch").val();chosen_probe_action(a);return false})}function set_feature_search_and_autocomplete(){var a="default";var b=new Object();b.id="#featureSearch";b.data_url=BASE_PATH+"genes/get_feature_search_autocomplete?feature_type=all&db_id="+db_id;b.target_url=BASE_PATH+"expressions/feature_result?graphType="+a+"&datasetID="+ds_id+"&feature_type=miRNA&db_id="+db_id+"&feature_id=";b.append_to=".searchBox";setup_feature_search_autocomplete(b);$("#featureSearchSubmit").click(function(){chosen_feature_action();return false});$("#featureSearchForm").submit(function(c){c.preventDefault();chosen_feature_action();return false})}function check_remove_loading(){if($("div.legend").length!=0){$("div.loading").removeClass("loading")}}function hide_tables(){$("#showTableData"+ds_id+" table").hide();$("#showRawTableData"+ds_id+" table").hide();$("#zoomGraphTableButton").hide()}function add_buttons_for_viewing_graph_tables(){$("#showGraphTableButton").click(function(){$("#showTableData"+ds_id+" table").toggle();$("#zoomGraphTableButton").toggle()});$("#zoomGraphTableButton").click(function(){if($("#showTableData"+ds_id+" td").css("font-size")=="8px"){$("#showTableData"+ds_id+" td").css("font-size","12px");$(this).html("- COLLAPSE TABLE")}else{$("#showTableData"+ds_id+" td").css("font-size","8px");$(this).html("+ EXPAND TABLE")}})}function plot_hover(){var a=null;$(this_graph_data.view_data.graph_id).bind("plothover",function(e,f,d){if(d){if(a!=d.datapoint){a=d.datapoint;$("#tooltip").remove();graph_type=this_graph_data.view_data.graph_type;var b=f.pageX.toFixed(2),c=f.pageY.toFixed(2);intX=parseInt(b);intY=parseInt(c);offset=this_graph_data.view_data.plot.offset();switch(graph_type){case"scatter":probe=d.series.label;sample_number=d.datapoint[0];expression_value=d.series.data[sample_number-1][1];sample_id=d.series.data[sample_number-1][2];description=sample_id+" - "+probe;break;case"bar":case"box":description=d.series.hoverLabel;break;case"line":description=d.series.hoverLabel+" ["+d.series.show_xaxis_labels_full[d.dataIndex]+"]";break}showTooltip(intX-offset.left+210,intY-offset.top+170,description)}}else{$("#tooltip").remove();a=null}})}function showTooltip(a,c,b){$('<div id="tooltip">'+b+"</div>").css({position:"absolute",display:"none",top:c,left:a,border:"1px solid #fdd",padding:"2px","z-index":101,"background-color":"#fee",opacity:0.8}).appendTo(this_graph_data.view_data.graph_id).fadeIn(200)}function click_linkButtons(){$("a.linkButtons").click(function(a){if($(this).attr("id")!="help"){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}}})}function set_clicks(){click_choose_graph_type();click_toggle_sd();click_choose_sort_type();click_zoom_horizontal();click_no_set_min_y_axis();click_choose_datasets();click_gene_info();click_view_genes();click_export_functions();click_share_link();click_linkButtons();click_select_probes()}function click_select_probes(){$("#toggle_select_probes").unbind();$("#toggle_select_probes").on("click",function(){if(this_graph_data.view_data.click_to_select_probes==false){this_graph_data.view_data.click_to_select_probes=true;selectGraphToDraw();probe_name_element=$("#probe_name");if(probe_name_element.length){probe_name=probe_name_element.html()}else{probe_name="Probe"}new_html='<div id="store_and_submit_select_probes" class="select_probes"><div class="title">Select '+probe_name+'s</div><div class="help">Click on the '+probe_name+'s under the graph to select and then submit to view them</div><textarea></textarea><input type="submit"></submit></div>';$("body").append(new_html);$("div.select_probes").draggable();$("div.select_probes input").click(function(){var b=new URL(document.URL);var a=$("div.select_probes textarea").val();a=a.replace(/\s{1,}/g,DELIMITER);b.get_data.select_probes=encodeURIComponent(a);new_url=b.get_url();window.location=new_url})}else{if(this_graph_data.view_data.click_to_select_probes==true){this_graph_data.view_data.click_to_select_probes=false;selectGraphToDraw();$("div.select_probes input").unbind();$("div.select_probes").draggable("disable");$("#store_and_submit_select_probes").remove()}}})}function toggle_standard_deviation(){var a=this_graph_data.view_data.show_standard_deviation;if(a=="on"){this_graph_data.view_data.show_standard_deviation="off"}else{this_graph_data.view_data.show_standard_deviation="on"}selectGraphToDraw()}function check_choose_dataset_immediately(){this_graph_data.choose_dataset_immediately=$("#choose_dataset_immediately").html();if(this_graph_data.choose_dataset_immediately=="True"){$("#chooseDatasets").click()}}function chosen_probe_action(b){var a="default";window.location=BASE_PATH+"expressions/probe_result?graphType="+a+"&datasetID="+ds_id+"&probe="+encodeURIComponent(b)+"&db_id="+db_id}function chosen_feature_action(){var a="default";var b=$("#featureSearch").val().replace("+","%2B");window.location=BASE_PATH+"expressions/feature_result?graphType="+a+"&datasetID="+ds_id+"&feature_type=miRNA&feature_id="+encodeURIComponent(b)+"&db_id="+db_id}function change_gene(a){if(a!=""&&a!=undefined){graph_type=this_graph_data.view_data.graph_type;sort_by=this_graph_data.view_data.sort_by;if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.host}new_url=window.location.origin+window.location.pathname+"?graphType="+graph_type+"&datasetID="+ds_id+"&gene="+a+"&db_id="+db_id+"&sortBy="+sort_by;window.location=new_url}}function set_large(){if(CURRENT_URL.queryKey.size=="large"){$(this_graph_data.view_data.graph_id).height(large_height).width(large_width)}else{$(this_graph_data.view_data.graph_id).height(small_height).width(small_width)}}function click_choose_graph_type(){$("a.chooseGraphType").unbind();$("a.chooseGraphType").on("click",function(){var a=$(this).attr("clickChoose");var c=window.location.href;switch(a){case"scatter":var b=c.replace(/graphType=[A-za-z]*/g,"graphType=scatter");break;case"bar":var b=c.replace(/graphType=[A-za-z]*/g,"graphType=bar");break;case"line":var b=c.replace(/graphType=[A-za-z]*/g,"graphType=line");break;case"box":var b=c.replace(/graphType=[A-za-z]*/g,"graphType=box");break}var b=b.replace("&size=large","");window.location=b})}function click_toggle_sd(){$("#toggleSD,a.toggle_sd").unbind();$("#toggleSD,a.toggle_sd").click(function(){toggle_standard_deviation()})}function click_choose_sort_type(){$("a.chooseSortType").unbind();$("a.chooseSortType").click(function(){var a=$(this).attr("clickChoose");$(this).addClass("bold");var c=window.location.href;var b=c.replace("#","").replace("%20").replace(/\&sortBy=[A-za-z 0-9\-]*/g,"");b=b+"&sortBy="+a;window.location=b})}function click_zoom_vertical(){$("#zoomVerticalGraphButton").unbind();$("#zoomVerticalGraphButton").click(function(){var a=$(this_graph_data.view_data.graph_id).css("height");if(a=="503px"){$(this_graph_data.view_data.graph_id).css("height","200px");selectGraphToDraw()}else{$(this_graph_data.view_data.graph_id).css("height","503px");selectGraphToDraw()}})}function click_zoom_horizontal(){graph_id=this_graph_data.view_data.graph_id;large_width=this_graph_data.view_data.probe_list.length*350;if(large_width>12000){large_width=12000}if(large_width<small_width){large_width=small_width}$("#zoomHorizontalGraphButton").unbind();$("#zoomHorizontalGraphButton").click(function(){var a=$(graph_id).css("width");if(a==small_width+"px"){$(graph_id).css("width",large_width+"px");$("div.backgroundGraph").css("width",(large_width+110)+"px");$("#xaxis_labels"+ds_id).css("width",(large_width-110)+"px");this_graph_data.view_data.expand_horizontally=true;this_graph_data.view_data.expand_horizontally_width=large_width;selectGraphToDraw()}else{$(graph_id).css("width",small_width);$("div.backgroundGraph").css("width",(small_width+110)+"px");$("#xaxis_labels"+ds_id).css("width",(small_width-110)+"px");this_graph_data.view_data.expand_horizontally=false;selectGraphToDraw()}})}function click_no_set_min_y_axis(){$("#no_set_min_y_axis_link").unbind();$("#no_set_min_y_axis_link").click(function(){no_set_min_y_axis=this_graph_data.view_data.min_y_axis;if(no_set_min_y_axis==null){this_graph_data.view_data.min_y_axis=this_graph_data.view_data.original_min_y_axis}else{this_graph_data.view_data.min_y_axis=null}selectGraphToDraw()})}function click_normal_link(){$("a.normal_link").unbind();$("a.normal_link").click(function(){window.location=$(this).attr("href")})}function click_choose_datasets(){$("#chooseDatasets").unbind();$("#chooseDatasets").click(function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}show_all_datasets();choose_dataset_filter()})}function click_gene_info(){$("a.geneInfoButton").unbind();$("a.geneInfoButton").click(function(){$("#displayGeneDetail").modal({onShow:function(a){$("#simplemodal-container").width("auto")}})})}function click_view_genes(){$("#viewGenes").unbind();$("#viewGenes").click(function(){$("#geneSearchForm").submit()})}function click_export_functions(){$(".export_graph_data").unbind();$(".export_graph_data").click(function(){ds_id=$(this).attr("data-id");identifier="#show_graph_data"+ds_id+" table";$(identifier).table2CSV()});export_image_button_click()}function click_share_link(){var a=$("#share_link,a.share_link");a.unbind().click(function(){value=check_user_logged_in_for_sharing();if(value==false){return false}var b=$("#gene_set_id");if(b.length==0){gene_set_id=0}else{gene_set_id=b.html()}$("#wb_modal_title").html("Share this graph");var c="<form id='share_link_form'><div id=help_share_link_form>Please note that you can add more than one email address separating each with commas and no spaces. Please be aware that this does not share private objects, such as datasets or gene lists. If the email address you use doesn't have access, they will not be able to view this graph.</div><dl><dt id='to_email_label'>To Email:</dt><dd><input id='to_email_input' class='share_input' type='text' name='to_email' value=''/></dd><dt>Subject:</dt><dd><input class='share_input' type='text' name='subject' value='"+SITE_NAME+" - Expression "+$("div.title").html()+"'/></dd><dt>Body:</dt><dd><textarea class='share_input' name='body' >Here is a link I thought you might want to see:\r\n"+window.location.href+'\r\n\r\nFrom "'+$("#full_name").html()+'" '+$("#user").html()+" via "+SITE_NAME+"</textarea></dd><dt><button id='share_link_form_submit' type='button'>Submit</button></dt><dd></dd></dl><div class='clear'/><input type='hidden' name='ds_id' value="+ds_id+"><input type='hidden' name='gene_set_id' value="+gene_set_id+"></form><div class='clear'/>";$("#wb_modal_content").html(c);$("#modal_div").modal({minHeight:480,onShow:function(d){var e=this;$("#share_link_form_submit").unbind("click");$("#share_link_form_submit").click(function(g){g.preventDefault();$(this).html("Sharing...").addClass("wait");$("#simplemodal-container").addClass("wait");var f=BASE_PATH+"auth/share_gene_expression";$.post(f,$("#share_link_form").serialize(),function(h){$("#wb_modal_title").html("Share this graph");$("#wb_modal_content").html(h);$("#simplemodal-container").height("auto").removeClass("wait")})})}})})}function choose_dataset_filter(){choose_dataset=$("#choose_dataset").dataTable({bPaginate:false,bLengthChange:false,bFilter:true,bSort:true,bInfo:false,aaSorting:[[0,"asc"]],aoColumns:[null],bAutoWidth:false})}function show_all_datasets(){$(".multi_select").modal({minWidth:800,maxHeight:500})};large=false;var min_border_margin=200;if(CURRENT_URL.queryKey.size=="large"){large=true;var min_border_margin=400}function set_label_dimensions(){var a=new Object();a.yaxis_ticks_abs_x=195;a.yaxis_label_abs_x=170;a.yaxis_label_abs_y=430;a.yaxis_tick_offset=0.2;a.yaxis_tick_start=0;a.yaxis_tick_steps=1;a.yaxis_decimal_places=0;return a}function graph_data(c,b,a){json_view_data=$("#json_view_data"+c).html();this.view_data=jQuery.parseJSON(json_view_data);this.view_data.graph_id=b;this.view_data.show_standard_deviation="on";this.view_data.original_min_y_axis=this.view_data.min_y_axis;this.view_data.label_dimensions=set_label_dimensions();json_datasets=$("#dataSets").html();this.dataSets=jQuery.parseJSON(json_datasets);this.ds_id=c;this.db_id=a}function selectGraphToDraw(){$("div.displayGraphs").addClass("loading");graph_type=this_graph_data.view_data.graph_type;line_graph_available=this_graph_data.view_data.line_graph_available;if(this_graph_data.view_data.plot_data=="{}"){$("div.loading").removeClass("loading");$(this_graph_data.graph_id).html('<div class="noGraphData">No data found for these parameters.</div>')}else{$("div.majorLabel").removeClass("majorLabel").addClass("majorLabelVertical");switch(graph_type){case"scatter":drawScatterPlot(this_graph_data.view_data);break;case"bar":drawBarPlot(this_graph_data.view_data);break;case"box":this_graph_data.view_data.show_standard_deviation="on";drawBoxPlot(this_graph_data.view_data);$("li.chooseSD").hide();break;case"line":this_graph_data.view_data.show_standard_deviation="on";drawLinePlot(this_graph_data.view_data);$("li.chooseSD").hide();break}}afterGraphDrawn()}function drawScatterPlot(l){var k=l.probe_list;var o=l.plot_data;var m=[];var h=0;var d=0;var g={};var b=l.number_of_samples;min_x_axis=l.min_x_axis;max_x_axis=l.max_x_axis;var e=l.show_standard_deviation;if(e=="on"){sd_data=l.plot_data_sd;for(var f in k){probe_id=k[f];if(sd_data.hasOwnProperty(probe_id)){var c=l.probe_color_dict[probe_id]["color"];for(var j in sd_data[probe_id]){if(sd_data[probe_id].hasOwnProperty(j)){m[h]={data:sd_data[probe_id][j],label:null,color:c,lines:{show:true},bandwidth:{show:true,lineWidth:bandwidth_line_width,lineThickness:2}};h++}}}}}if(l.hasOwnProperty("draw_scatter_with_lines")){draw_scatter_with_lines=l.draw_scatter_with_lines}else{draw_scatter_with_lines=false}for(var f in k){probe_id=k[f];if(o.hasOwnProperty(probe_id)){var c=l.probe_color_dict[probe_id]["color"];m[h]={data:o[probe_id],color:c,label:probe_id,lines:{show:draw_scatter_with_lines},points:{show:true}};h++;d++}}m=set_detection_threshold_and_median(l,m,h);l.flot_data=m;markings=set_markings_to_array(l);var a=l.min_y_axis;var n=l.max_y_axis;var p={xaxis:{min:min_x_axis,max:max_x_axis,ticks:[],mode:null},yaxis:{min:a,max:n,font:{size:0,family:"sans-serif",variant:"small-caps"}},grid:{minBorderMargin:min_border_margin,backgroundColor:"#FFF",markings:markings,hoverable:true}};l.options=p;var i=drawGraph(l)}function drawBarPlot(j){var q=j.plot_data;var l=[];var h=0;var g=Array();markings=set_markings_to_array(j);xaxis_labels=j.xaxis_labels;min_x_axis=j.min_x_axis;max_x_axis=j.max_x_axis;var f=j.show_standard_deviation;for(var i in q){if(q.hasOwnProperty(i)){var e=q[i]["color"];var k=i;for(var o in q[i]["values"]){if(q[i]["values"].hasOwnProperty(o)){var p=q[i]["values"][o]["sd"];var b=q[i]["values"][o]["average"];var n=q[i]["values"][o]["xaxis"];var d=q[i]["values"][o]["extra_info"];var c=q[i]["values"][o]["level_above"];l[h]={data:[[n,b]],color:e,hoverLabel:i+d+" - "+c,label:k,bars:{show:true,barWidth:1,align:"center"}};k=null;h++;if(f=="on"&&p>0){flot_graph_data=new Array();flot_graph_data[0]=new Array();flot_graph_data[1]=new Array();flot_graph_data[0][0]=n;flot_graph_data[0][1]=b+p;flot_graph_data[1][0]=n;flot_graph_data[1][1]=b-p;l[h]={data:flot_graph_data,label:null,color:e,lines:{show:true},bandwidth:{show:true,lineWidth:bandwidth_line_width,lineThickness:3},hoverable:false};h++}}}}}var a=j.min_y_axis;var m=j.max_y_axis;l=set_detection_threshold_and_median(j,l,h);j.flot_data=l;j.options=set_options_bar_and_box(j);drawGraph(j)}function drawBoxPlot(i){var w=i.plot_data;var n=[];var f=0;var h=Array();var e=set_markings_to_array(i);xaxis_labels=i.xaxis_labels;min_x_axis=i.min_x_axis;max_x_axis=i.max_x_axis;var c=0;for(var s in w){if(w.hasOwnProperty(s)){var p=w[s]["color"];for(var u in w[s]["values"]){if(w[s]["values"].hasOwnProperty(u)){var b=w[s]["values"][u]["average"];var t=w[s]["values"][u]["max"];var g=w[s]["values"][u]["median"];var m=w[s]["values"][u]["min"];var a=w[s]["values"][u]["sd"];var d=w[s]["values"][u]["xaxis"];var l=w[s]["values"][u]["Q1"];var k=w[s]["values"][u]["Q3"];var o=w[s]["values"][u]["level_above"];var j=w[s]["values"][u]["extra_info"];var v=s+j+" - "+o;n[f]={data:[[d,t],[d,m]],hoverLabel:v,label:null,color:p,lines:{show:true},bandwidth:{show:true,lineWidth:15,lineThickness:3},hoverable:true};f++;var r=null;if(u==0){r=s}n[f]={data:[[d,k,l]],color:p,hoverLabel:v,label:r,bars:{show:true,barWidth:0.8,align:"center",fill:true,fillColor:p}};f++;n[f]={data:[[d,g,g]],color:"#FFF",label:null,bars:{show:true,barWidth:0.8,align:"center"},hoverable:false};f++}}}}n=set_detection_threshold_and_median(i,n,f);i.flot_data=n;min_y_axis=i.min_y_axis;max_y_axis=i.max_y_axis;i.options=set_options_bar_and_box(i);var q=drawGraph(i)}function set_options_bar_and_box(b){var a={series:{bandwidth:{active:true,drawBandwidth:function(d,h,c,g,f,e){d.beginPath();d.strokeStyle=e;d.lineWidth=1;d.moveTo(c,g);d.stroke();d.beginPath();d.strokeStyle=e;d.lineWidth=h.lineWidth;d.lineThickness=1;d.lineThickness=h.lineThickness;d.moveTo(c,g);d.lineTo(c,g+d.lineThickness);d.stroke()}}},xaxis:{min:b.min_x_axis,max:b.max_x_axis,ticks:b.x_axis_ticks,mode:null,font:{size:0}},yaxis:{min:b.min_y_axis,max:b.max_y_axis,font:{size:0,family:"sans-serif",variant:"small-caps"}},grid:{minBorderMargin:min_border_margin,backgroundColor:"#FFF",markings:markings,hoverable:true}};return a}function drawLinePlot(j){var o=j.plot_data;var k=[];var g=0;var f=set_markings_to_array(j);min_x_axis=j.min_x_axis;max_x_axis=j.max_x_axis;var d="on";var p=0;var e={};list_color_dict={};var i={};if(typeof j.xaxis_labels_original==="undefined"){j.xaxis_labels_original=j.xaxis_labels}for(var h in j.xaxis_labels_original.full){label_name=j.xaxis_labels_original.full[h].name;xaxis_position=j.xaxis_labels_original.full[h].xaxis_position;i[xaxis_position]=label_name}for(var h in o){if(o.hasOwnProperty(h)){values_array=new Array();var q=0;for(var n in o[h]["values"]){var m=o[h]["values"][n]["sd"];var a=o[h]["values"][n]["average"];var l=o[h]["values"][n]["xaxis"];var b=o[h]["values"][n]["extra_info"];var c=o[h]["color"];label=null;values_array[l]=[l,a];if(d=="on"&&m>0){graph_data=new Array();graph_data[0]=new Array();graph_data[1]=new Array();graph_data[0][0]=l;graph_data[0][1]=a+m;graph_data[1][0]=l;graph_data[1][1]=a-m;k[g]={data:graph_data,label:null,color:c,lines:{show:true},bandwidth:{show:true,lineWidth:30,lineThickness:3},hoverable:false};g++}}temp_label=h.split("|");new_label=temp_label[1]+" - "+temp_label[0];k[g]={data:values_array,color:c,hoverLabel:new_label+b,label:label,points:{show:true},lines:{show:true},show_xaxis_labels_full:i};g++}}j.options=set_options_bar_and_box(j);if(j.expand_horizontally||Object.keys(j.xaxis_labels_original.full).length<35){j.xaxis_labels=j.xaxis_labels_original.full}else{j.xaxis_labels=j.xaxis_labels_original.summary}j.flot_data=set_detection_threshold_and_median(j,k,g);drawGraph(j)};